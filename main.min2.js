function iAC(t,a){var e=document.getElementById(t);if(e){var n=e.scrollTop,c=0,i=e.selectionStart||"0"==e.selectionStart?"ff":!!document.selection&&"ie";if("ie"==i){e.focus();var r=document.selection.createRange();r.moveStart("character",-e.value.length),c=r.text.length}else"ff"==i&&(c=e.selectionStart);var l=e.value.substring(0,c),o=e.value.substring(c,e.value.length);if(e.value=l+a+o,c+=a.length,"ie"==i){e.focus();var h=document.selection.createRange();h.moveStart("character",-e.value.length),h.moveStart("character",c),h.moveEnd("character",0),h.select()}else"ff"==i&&(e.selectionStart=c,e.selectionEnd=c,e.focus());e.scrollTop=n}}Rchat.internal={},Rchat.internal.init=function(){localStorage.chat_op||localStorage.setItem("chat_op","0"),$("body").append(Rchat.config.html),Rchat.internal.op_cl($("#chat_btn")),Rchat.internal.vars.receiving=1,Rchat.internal.get_data(),Rchat.internal.init_send(),Rchat.internal.smilies_init(),Rchat.internal.reset()},Rchat.internal.op_cl=function(t){"1"==localStorage.getItem("chat_op")&&($("#chat_inner").toggleClass("chat_open"),Rchat.internal.vars.receiving=1),t.click(function(t){$("#chat_inner").toggleClass("chat_open"),localStorage.setItem("chat_op",$("#chat_inner").hasClass("chat_open")?"1":"0"),"1"==localStorage.chat_op&&"0"==!$("#chat_btn_notif").text()&&($("#chat_btn_notif").text("0"),$("#chat_content").scrollTop($("#chat_content")[0].scrollHeight))})},Rchat.internal.reset=function(){Rchat.internal.vars.resetting||$("#chat_head>span").click(function(){$(this).css({cursor:"not-allowed",opacity:"0.9"}),Rchat.internal.vars.resetting=1,localStorage.removeItem("chat_op"),localStorage.removeItem("emo"),Rchat.internal.vars.resetting=0,$(this).css({cursor:"pointer",opacity:"1.0"}),window.location.reload()})},Rchat.internal.vars={},Rchat.internal.vars.sending=0,Rchat.internal.vars.receiving=1,Rchat.internal.vars.mess_per_page=20,Rchat.internal.vars.ct=[],Rchat.internal.vars.auth_data=[],Rchat.internal.vars.index=0,Rchat.internal.vars.resetting=0,Rchat.internal.get_data=function(){Rchat.internal.vars.receiving?$.get(Rchat.config.topic+"?view=newest",function(t){Rchat.internal.vars.index++,$("#chat_content>center").length&&$("#chat_content>center").remove();var a=$("#chat_sis",t),e=a.length,n=0;if(Rchat.internal.vars.auth_data=[$("[name='auth[]']",t).eq(0).val(),$("[name='auth[]']",t).eq(1).val()],e<Rchat.internal.vars.ct.length)for(Rchat.internal.vars.ct=[],$("#chat_content").empty();n<e;n++)Rchat.internal.vars.ct.push(a.eq(n).html()),$("#chat_content").append(a.eq(n).html()),"0"!=localStorage.chat_op||1!=a.eq(n).html().split(_userdata.username).length||Rchat.internal.vars.index||$("#chat_btn_notif").text(parseInt($("#chat_btn_notif").text().match(/\d+/))+1),$("#chat_content").scrollTop($("#chat_content")[0].scrollHeight);else for(;n<e;n++)a.eq(n).html()!=Rchat.internal.vars.ct[n]&&n<Rchat.internal.vars.ct.length?(Rchat.internal.vars.ct[n]=a.eq(n).html(),$("#chat_content>div").eq(n).html(a.eq(n).html())):a.eq(n).html()!=Rchat.internal.vars.ct[n]&&($("#chat_content").append(a.eq(n).html()),"0"!=localStorage.chat_op||1!=a.eq(n).html().split(_userdata.username).length||Rchat.internal.vars.index||$("#chat_btn_notif").text(parseInt($("#chat_btn_notif").text().match(/\d+/))+1),$("#chat_content").scrollTop($("#chat_content")[0].scrollHeight),Rchat.internal.vars.ct[n]=a.eq(n).html());setTimeout(function(){Rchat.internal.get_data()},Rchat.config.delay)}):setTimeout(function(){Rchat.internal.get_data()},Rchat.config.delay)},Rchat.internal.comp=function(t){return'<div id="chat_sis" class="chat"><div id="chat_bl"><div id="chat_group"><div id="chat_avatar"><img src="'+_userdata.avatar.match(/"(.+?)(?=")/)[1]+'"/></div><div id="chat_name">'+_userdata.username+'</div></div><div id="chat_message">'+t+"</div></div></div>"},Rchat.internal.send=function(t){if(!Rchat.internal.vars.sending){if(0==t.length)return $("#chat_btts").after("<div id='send_fail'>"+Rchat.lang.no_empty+"</div>"),void setTimeout(function(){$("#send_fail").fadeOut(function(){$("#send_fail").remove()})},2e3);Rchat.internal.vars.sending=1,$("#chat_form_send").toggleClass("act_bt"),$.post("/post",{mode:"reply",t:Rchat.config.topic.match(/\d+/)[0],message:Rchat.internal.comp(t),post:"Ok",auth:Rchat.internal.vars.auth_data},function(){Rchat.internal.after_send()})}},Rchat.internal.after_send=function(){Rchat.internal.vars.sending=0,$(".act_bt").removeClass("act_bt")},Rchat.internal.init_send=function(){$("#chat_form_send").click(function(){Rchat.internal.send($("#chat_form_input").val()),$("#chat_form_input").val("")}),$(document).keypress(function(t){13==t.which&&(Rchat.internal.send($("#chat_form_input").val()),$("#chat_form_input").val(""))})},Rchat.internal.smilies={},Rchat.internal.smilies.populate=function(){var t;void 0!=localStorage.emo?(t=localStorage.emo,$("#chat_smi_pop").append(t.replace(/alt/g,"data_emoji")),$("[data_emoji]").wrap("<span></span>"),$("[data_emoji]").click(function(t){iAC("chat_form_input",$(this).attr("data_emoji"))})):$.get("/smilies.forum?mode=smilies_frame",function(a){t=$(a).filter(".smiley-element").html(),localStorage.emo=t,$("#chat_smi_pop").append(t.replace(/alt/g,"data_emoji")),$("[data_emoji]").wrap("<span></span>"),$("[data_emoji]").click(function(t){iAC("chat_form_input",$(this).attr("data_emoji"))})})},Rchat.internal.smilies_bind=function(){1==$("#chat_smi_pop").length?$("#chat_smi_pop").remove():($("#chat_form").append("<div id='chat_smi_pop'><div id='chat_smi_pop_head'>"+Rchat.lang.emoji_head+"</div></div>"),Rchat.internal.smilies.populate())},Rchat.internal.smilies_init=function(){$("#chat_smilies").click(function(t){Rchat.internal.smilies_bind()})},Rchat.internal.init();